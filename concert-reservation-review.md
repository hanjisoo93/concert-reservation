# 📌 콘서트 예약 시스템 개발 회고

## 🔹 프로젝트 개요

이번 프로젝트는 콘서트 예약 서비스를 개발하는 것이 목표였다. 단순한 예약 시스템이 아니라 대기열을 관리하고, 동시성을 고려한 좌석 예약 및 결제 기능을 구현하는 것이 핵심 과제였다.

특히, "다수의 유저가 동시에 좌석을 예약하려고 할 때 어떻게 안전하게 처리할 것인가?" 가 가장 큰 도전이었다.


## 📅 1주차: 설계 & 환경 구축

### 1️⃣ 기능 정의 & 설계

1. 시나리오 선정 → 콘서트 예약 서비스

2. Milestone 정의 → 대기열 관리, 좌석 예약, 포인트 충전, 결제 API 개발

3. 시퀀스 다이어그램, 플로우 차트 작성 → 전체 서비스 흐름을 시각화

4. ERD 설계 → 유저, 예약, 좌석, 결제, 포인트 테이블 정의

### ✅ 주요 고민:

1. 다양한 다이어그램의 종류, 어떤걸 써야 하지?
2. 플로우 차트는 어디까지 그려야 하지?
3. 앞으로 대기열을 어떻게 관리할 것인가?

### 2️⃣ API 명세 & 기본 환경 설정

1. API 명세서 작성 → Swagger 문서화

2. Mock API 구현 → 프론트엔드 연동을 고려한 API 구조 설계

3. 패키지 구조 정의 → application, domain, infra, interfaces 분리

4. TestContainer 도입 → MySQL 기반 통합 테스트 환경 구축
---
## 📅 2주차: 핵심 기능 개발 & 단위 테스트

### 1️⃣ 핵심 비즈니스 로직 구현

1. 대기열 토큰 발급 및 검증 기능

2. 좌석 예약 API 개발 → 좌석을 일정 시간 동안 임시 배정

3. 포인트 충전 / 차감 로직 개발

4. 결제 처리 API 개발 → 결제 완료 시 예약 확정

### ✅ 주요 고민:

1. 비관적 락(Pessimistic Lock) 적용 및 동시성 제어
2. Facade 패턴을 어떻게 사용하면 좋을까...
2. Usecase..?

### 2️⃣ 단위 테스트 & 통합 테스트

1. MockMvc를 활용한 컨트롤러 테스트

2. 비즈니스 로직 단위 테스트 작성

3. API 전체 흐름을 검증하는 통합 테스트 작성

### ✅ 주요 고민:

1. 단위 테스트 vs 통합 테스트의 범위를 어떻게 나눌 것인가?
2. Repository 까지 테스트 해야 하나?
---
## 📅 3주차: 동시성 제어 & 안정화 작업

### 1️⃣ 예외 처리 및 보안 강화

1. 글로벌 예외 처리 적용

2. Interceptor를 활용한 토큰 검증 로직 추가

3. 모든 API 요청 시 대기열 검증 필수화

### ✅ 주요 고민:

1. 대기열 검증을 어디에서 수행하는 것이 가장 효율적인가?

2. 예외 메시지를 어떻게 일관되게 관리할 것인가?

### 2️⃣ 동시성 문제 해결 & 테스트

1. 포인트 차감 및 좌석 예약에 대한 동시성 제어 적용

2. 비관적 락 (PESSIMISTIC_WRITE) 도입

3. 다중 트랜잭션에서의 데드락 발생 가능성 분석 및 해결

### ✅ 주요 고민:

1. 비관적 락을 어디까지 적용해야 하는가?

2. 테스트 환경에서 동시성을 어떻게 검증할 것인가?
---
## 🔍 프로젝트를 통해 배운 것

### 1️⃣ "동시성 문제는 단순하지 않다."

처음에는 단순하게 "좌석이 예약되었는지 확인한 후 예약하면 되지 않나?" 라고 생각했다. 하지만, 여러 사용자가 동시에 같은 좌석을 예약하려고 하면 데이터 불일치, 중복 예약, 심지어 데드락까지 발생할 수 있다.

결국, 비관적 락과 트랜잭션 제어를 통해 중복 예약을 방지했지만, 퍼포먼스 최적화와 트랜잭션 관리가 동시에 필요했다.

### 2️⃣ "API가 동작한다고 끝이 아니다."

초기에는 API가 정상적으로 동작하면 개발이 끝났다고 생각했다. 하지만, 실제로 다중 사용자가 동시에 요청을 보내면 완전히 다른 문제가 발생한다. 이를 해결하기 위해 동시성 테스트를 작성하고, 비관적 락을 적용하면서 문제를 하나씩 해결해 나갔다.

### 3️⃣ "테스트는 필수다... 겁내지 말자..."

테스트 없이 개발했다면, 동시 요청에서 어떤 문제가 발생할지 전혀 예측할 수 없었을 것이다. 단위 테스트, 통합 테스트, 동시성 테스트를 작성하면서 "테스트가 없으면 신뢰할 수 없는 코드" 라는 걸 다시 한번 깨달았다.

---

## 🚀 회고

이번 프로젝트는 단순한 CRUD API 개발이 아니라, "실제 운영 환경에서도 안정적으로 동작하는 시스템을 구축하는 경험" 이었다. 특히 동시성 문제를 해결하는 과정에서 많은 시행착오를 겪었지만, 이를 직접 해결하면서 실질적인 성장을 이룰 수 있었다.

아직 개선해야 할 점이 남아있지만, 이번 프로젝트를 통해 "단순히 기능이 구현된 코드"가 아닌, 실제 환경에서 신뢰할 수 있는 시스템을 만드는 경험을 했다는 점이 가장 큰 수확이었다.

